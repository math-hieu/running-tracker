// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Activity {
  id          String   @id @default(cuid())
  userId      String
  stravaId    String?  @unique // ID de l'activité Strava
  title       String
  description String?
  distance    Float    // Distance en kilomètres
  duration    Int      // Durée en secondes
  pace        Float    // Allure en min/km
  date        DateTime @default(now())
  startTime   DateTime?
  endTime     DateTime?
  calories    Int?
  elevation   Float?   // Dénivelé en mètres
  heartRate   Int?     // Fréquence cardiaque moyenne
  route       Json?    // Données GPS du parcours (format GeoJSON)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([date])
  @@index([stravaId])
  @@map("activities")
}

model User {
  id                  String              @id @default(cuid())
  email               String              @unique
  name                String?
  stravaAthleteId     String?             @unique
  stravaAccessToken   String?
  stravaRefreshToken  String?
  stravaTokenExpiry   DateTime?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  activities          Activity[]
  sessionCompletions  SessionCompletion[]

  @@map("users")
}

model SessionCompletion {
  id            String   @id @default(cuid())
  userId        String

  // Identification de la session (correspond au JSON)
  weekNumber    Int
  dayOfWeek     String?  // "Tue", "Thu", "Sun", etc. (nullable pour sessions sans jour spécifique)
  sessionType   String   // "Footing EF", "Sortie longue trail EF", etc.

  // Date de complétion
  completedAt   DateTime @default(now())

  // Metadata
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Index et contraintes
  @@unique([userId, weekNumber, dayOfWeek, sessionType])
  @@index([userId])
  @@index([userId, weekNumber])
  @@map("session_completions")
}
